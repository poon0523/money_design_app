{"ast":null,"code":"import jQuery from \"jquery\";\nimport I18n from \"./i18n\";\nimport flatpickr from \"flatpickr\";\n(function ($) {\n  var filters;\n  $.filters = filters = {\n    append: function (options) {\n      var field_label = options[\"label\"];\n      var field_name = options[\"name\"];\n      var field_type = options[\"type\"];\n      var field_value = options[\"value\"] || \"\";\n      var field_operator = options[\"operator\"];\n      var operators = options[\"operators\"];\n      var index = options[\"index\"];\n      var value_name = \"f[\" + field_name + \"][\" + index + \"][v]\";\n      var operator_name = \"f[\" + field_name + \"][\" + index + \"][o]\";\n      var control = null;\n      var additional_control = null;\n      if (operators.length > 0) {\n        control = $('<select class=\"form-control form-select form-select-sm\"></select>').prop(\"name\", operator_name);\n        operators.forEach(operator => {\n          var element = this.build_operator(operator, options);\n          if (!element) {\n            return;\n          }\n          if (element.prop(\"value\") === field_operator) {\n            element.prop(\"selected\", true);\n          }\n          control.append(element);\n        });\n        if (control.find(\"[data-additional-fieldset]\").length > 0) {\n          control.addClass(\"switch-additional-fieldsets\");\n        }\n      }\n      switch (field_type) {\n        case \"boolean\":\n          control && control.prop(\"name\", value_name).find(\"option\").each(function () {\n            if ($(this).attr(\"value\") === field_value) $(this).attr(\"selected\", true);\n          });\n          break;\n        case \"date\":\n        case \"datetime\":\n        case \"timestamp\":\n        case \"time\":\n          additional_control = $.map([undefined, \"-∞\", \"∞\"], function (placeholder, index) {\n            var visible = index == 0 ? !field_operator || field_operator == \"default\" : field_operator == \"between\";\n            return $('<span class=\"additional-fieldset\"></span>').addClass(index == 0 ? \"default\" : \"between\").css(\"display\", visible ? \"inline-block\" : \"none\").html($('<input class=\"input-sm form-control form-control-sm\" type=\"text\" />').addClass(field_type == \"date\" ? \"date\" : \"datetime\").prop(\"name\", value_name + \"[]\").prop(\"value\", field_value[index] || \"\").prop(\"size\", field_type == \"date\" || field_type == \"time\" ? 20 : 25).prop(\"placeholder\", placeholder));\n          });\n          break;\n        case \"enum\":\n          if (control) {\n            var multiple = field_value instanceof Array;\n            control = control.prop(\"name\", multiple ? value_name + \"[]\" : value_name).prop(\"multiple\", multiple).add($('<a href=\"#\" class=\"switch-select\"></a>').append($(\"<i></i>\").addClass(\"fas fa-\" + (multiple ? \"minus\" : \"plus\"))));\n            control.find(\"option\").each(function () {\n              const value = $(this).attr(\"value\");\n              if (multiple ? field_value.includes(value) : value === field_value) $(this).attr(\"selected\", true);\n            });\n            if (multiple) control.find(\"option[value^=_],option[disabled]\").hide();\n          }\n          break;\n        case \"citext\":\n        case \"string\":\n        case \"text\":\n        case \"belongs_to_association\":\n        case \"has_one_association\":\n          additional_control = $('<input class=\"additional-fieldset form-control form-control-sm\" type=\"text\" />').css(\"display\", field_operator == \"_present\" || field_operator == \"_blank\" ? \"none\" : \"inline-block\").prop(\"name\", value_name).prop(\"value\", field_value);\n          break;\n        case \"integer\":\n        case \"decimal\":\n        case \"float\":\n          additional_control = $('<input class=\"additional-fieldset default form-control form-control-sm\" type=\"text\" />').css(\"display\", !field_operator || field_operator == \"default\" ? \"inline-block\" : \"none\").prop(\"type\", field_type).prop(\"name\", value_name + \"[]\").prop(\"value\", field_value[0] || \"\").add($('<input placeholder=\"-∞\" class=\"additional-fieldset between form-control form-control-sm\" />').css(\"display\", field_operator == \"between\" ? \"inline-block\" : \"none\").prop(\"type\", field_type).prop(\"name\", value_name + \"[]\").prop(\"value\", field_value[1] || \"\")).add($('<input placeholder=\"∞\" class=\"additional-fieldset between form-control form-control-sm\" />').css(\"display\", field_operator == \"between\" ? \"inline-block\" : \"none\").prop(\"type\", field_type).prop(\"name\", value_name + \"[]\").prop(\"value\", field_value[2] || \"\"));\n          break;\n        default:\n          control = $('<input type=\"text\" class=\"form-control form-control-sm\" />').prop(\"name\", value_name).prop(\"value\", field_value);\n          break;\n      }\n      var filterContainerId = field_name + \"-\" + index + \"-filter-container\";\n      $(\"#\" + filterContainerId).remove();\n      var $content = $(\"<div>\").attr(\"id\", filterContainerId).addClass(\"filter d-inline-block my-1\").append($('<button type=\"button\" class=\"btn btn-info btn-sm delete\"></button>').append('<i class=\"fas fa-trash\"></i>').append(document.createTextNode(field_label))).append(\"&nbsp;\").append(control).append(\"&nbsp;\").append(additional_control);\n      $(\"#filters_box\").append($content);\n      $content.find(\".date, .datetime\").each(function () {\n        flatpickr(this, $.extend({\n          dateFormat: \"Y-m-dTH:i:S\",\n          altInput: true,\n          locale: I18n.locale\n        }, options[\"datetimepicker_options\"]));\n      });\n      $(\"hr.filters_box:hidden\").show(\"slow\");\n    },\n    build_operator: function (operator, options) {\n      if (operator instanceof Object) {\n        var element = $(\"<option></option>\");\n        element.text(operator.label);\n        delete operator.label;\n        for (const key in operator) {\n          element.attr(key, operator[key]);\n        }\n        return element;\n      }\n      switch (operator) {\n        case \"_discard\":\n          return $('<option value=\"_discard\">...</option>');\n        case \"_separator\":\n          return $('<option disabled=\"disabled\">---------</option>');\n        case \"_present\":\n          return $('<option value=\"_present\"></option>').text(I18n.t(\"is_present\"));\n        case \"_blank\":\n          return $('<option value=\"_blank\"></option>').text(I18n.t(\"is_blank\"));\n        case \"_not_null\":\n          return $('<option value=\"_not_null\"></option>').text(I18n.t(\"is_present\"));\n        case \"_null\":\n          return $('<option value=\"_null\"></option>').text(I18n.t(\"is_blank\"));\n        case \"true\":\n          return $('<option value=\"true\"></option>').text(I18n.t(\"true\"));\n        case \"false\":\n          return $('<option value=\"false\"></option>').text(I18n.t(\"false\"));\n        case \"today\":\n          return $('<option value=\"today\"></option>').text(I18n.t(\"today\"));\n        case \"yesterday\":\n          return $('<option value=\"yesterday\"></option>').text(I18n.t(\"yesterday\"));\n        case \"this_week\":\n          return $('<option value=\"this_week\"></option>').text(I18n.t(\"this_week\"));\n        case \"last_week\":\n          return $('<option value=\"last_week\"></option>').text(I18n.t(\"last_week\"));\n        case \"like\":\n          return $('<option data-additional-fieldset=\"additional-fieldset\" value=\"like\"></option>').text(I18n.t(\"contains\"));\n        case \"not_like\":\n          return $('<option data-additional-fieldset=\"additional-fieldset\" value=\"not_like\"></option>').text(I18n.t(\"does_not_contain\"));\n        case \"is\":\n          return $('<option data-additional-fieldset=\"additional-fieldset\" value=\"is\"></option>').text(I18n.t(\"is_exactly\"));\n        case \"starts_with\":\n          return $('<option data-additional-fieldset=\"additional-fieldset\" value=\"starts_with\"></option>').text(I18n.t(\"starts_with\"));\n        case \"ends_with\":\n          return $('<option data-additional-fieldset=\"additional-fieldset\" value=\"ends_with\"></option>').text(I18n.t(\"ends_with\"));\n        case \"default\":\n          var label;\n          switch (options.type) {\n            case \"date\":\n            case \"datetime\":\n            case \"timestamp\":\n              label = I18n.t(\"date\");\n              break;\n            case \"time\":\n              label = I18n.t(\"time\");\n              break;\n            case \"integer\":\n            case \"decimal\":\n            case \"float\":\n              label = I18n.t(\"number\");\n              break;\n          }\n          return $('<option data-additional-fieldset=\"default\" value=\"default\"></option>').text(label);\n        case \"between\":\n          return $('<option data-additional-fieldset=\"between\" value=\"between\"></option>').text(I18n.t(\"between_and_\"));\n        default:\n          return null;\n      }\n    }\n  };\n  $(document).on(\"click\", \"#filters a\", function (e) {\n    e.preventDefault();\n    $.filters.append($.extend({\n      index: $.now().toString().slice(6, 11)\n    }, $(this).data(\"options\")));\n  });\n  $(document).on(\"click\", \"#filters_box .delete\", function (e) {\n    e.preventDefault();\n    var form = $(this).parents(\"form\");\n    $(this).parents(\".filter\").remove();\n    !$(\"#filters_box\").children().length && $(\"hr.filters_box:visible\").hide(\"slow\");\n  });\n  $(document).on(\"click\", \"#filters_box .switch-select\", function (e) {\n    e.preventDefault();\n    var select = $(this).siblings(\"select\");\n    select.attr(\"multiple\", !select.attr(\"multiple\"));\n    select.attr(\"name\", select.attr(\"multiple\") ? select.attr(\"name\") + \"[]\" : select.attr(\"name\").replace(/\\[\\]$/, \"\"));\n    select.find(\"option[value^=_],option[disabled]\").toggle();\n    $(this).find(\"i\").toggleClass(\"fa-plus fa-minus\");\n  });\n  $(document).on(\"change\", \"#filters_box .switch-additional-fieldsets\", function (e) {\n    var selected_option = $(this).find(\"option:selected\");\n    var klass = $(selected_option).data(\"additional-fieldset\");\n    if (klass) {\n      $(this).siblings(\".additional-fieldset:not(.\" + klass + \")\").hide(\"slow\");\n      $(this).siblings(\".\" + klass).show(\"slow\");\n    } else {\n      $(this).siblings(\".additional-fieldset\").hide(\"slow\");\n    }\n  });\n})(jQuery);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}